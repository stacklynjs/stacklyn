class Stacklyn{"use strict";static parse(e,t={ALLOW_CALLSITES:!1}){if(!Stacklyn._isValidError(e))return;let n,a;function l(e,t=!1){return t||!e.stack?{name:e.name,message:e.message,header:e.toString()}:e.stack?.replace(e.toString()+"\n","")}e.toString=Error.prototype.toString;let o=!!(navigator?.userAgent?.includes("Chrome")||process||window?.chrome),r=!!(o&&!0===t.ALLOW_CALLSITES&&e instanceof Error);if(r)a=Stacklyn.parseCS(e);else{(n=e.stack.split("\n").filter(Boolean)||[]).includes(e.toString())&&(n=l(e).split("\n").filter(Boolean));let i=n?.some(e=>e.startsWith("    at ")),c=n?.some(e=>e.startsWith("   at ")),s=n?.some(e=>e.includes("     ^")),u=n?.some(e=>/^.*?@.+?(:\d+)?(?::\d+)?$/.test(e));if("failed"!==Stacklyn._detectOperaMode(e))a=Stacklyn.parseOpera(e).filter(Boolean);else if(s)a=Stacklyn.parseEspruino(e).filter(Boolean);else if(i)a=(n=l(e,!1).split("\n").filter(Boolean)).map(e=>Stacklyn.parseV8(e,null)).filter(Boolean);else if(c)a=(n=l(e,!1).split("\n").filter(Boolean)).map(e=>Stacklyn.parseIE(e)).filter(Boolean);else if(u)a=n.map(e=>Stacklyn.parseSpiderMonkey(e)).filter(Boolean);else throw new Stacklyn.Error("unsupported stacktrace format:",e,{cause:e})}return(a=Stacklyn._filterUndefined(a)).error={...Stacklyn.serializeError(e),parsedStack:Array.from(a)},a}static parseCS(e){if(!Stacklyn._isValidError(e))return;let t=0,{stack:n,callSites:a}=Stacklyn.getCallSites(e),l=Stacklyn._filterUndefined(n.split("\n").slice(1).map(e=>Stacklyn.parseV8(e,a[t++])));return l.error={...Stacklyn.serializeError(e),parsedStack:Array.from(l),callSites:a},l}static parseV8(e,t){if(!e.startsWith("    at"))return;let n,a,l={host:"Chromium",format:"V8",type:"browser"},o,r,i;if(e.includes("(")&&e.includes(")")){let c=e.match(/^ {4}at (.+?)(?: \[as ([^\]]+)\])?\s*\((.+)\)\s*$/);c&&([,o,r,i]=c)}else{let s=e.match(/^ {4}at (.+)$/);s&&([,i]=s)}let u=["native","unknown location","<anonymous>"].some(e=>i===e),m=["native:","<anonymous>:"].some(e=>i.startsWith(e));if(u||!i)n={sourceURL:i,anonymous:!0};else if(m){i.startsWith("native:")&&(l.host="Bun",l.type="runtime");let{line:f,column:p}=Stacklyn._extractLocation(i);n={sourceURL:null,fileName:null,line:f,column:p,anonymous:!0}}else if("unknown"===i)l.host="Bun",l.type="runtime",n={sourceURL:i,anonymous:!0};else if(i.startsWith("eval at"))n=function e(t){let n=null,a=null,l=0,o=t.match(/, ([^,]+:\d+:\d+)$/);o&&(a=o[1],t=t.slice(0,t.lastIndexOf(", ")));let r=[];for(;t.startsWith("eval at ",l);){l+=8;let i=t.indexOf(" (",l),c=t.slice(l,i),s=1,u=i+2;for(l=i+2;u<t.length&&s>0;)"("===t[u]?s++:")"===t[u]&&s--,u++;let m=t.slice(l,u-1);r.push({name:c,location:null,inner:m}),t=m,l=0}r.length&&t.match(/:\d+:\d+$/)&&(r[r.length-1].location=t),a&&r.length&&(r[0].location=a);for(let f=r.length-1;f>=0;f--){let p=null,y=null,d=null,{name:h,location:k}=r[f],S=k?.match(/^(.*):(\d+):(\d+)$/);S?[,p,y,d]=S:k&&(p=k),n={name:h,sourceURL:p||null,fileName:p?.includes("://")?Stacklyn._getFilename(p):null,line:y?Number(y):null,column:d?Number(d):null,eval:n}}return n}(i);else if(i){i.startsWith("node:")&&(l.host="Node.js",l.type="runtime");let{line:y,column:d}=Stacklyn._extractLocation(i),h=Stacklyn._cleanPath(i);n={sourceURL:h,fileName:Stacklyn._getFilename(h),line:y,column:d,anonymous:!h}}if(o?.includes("<anonymous>"))a=o.endsWith(".<anonymous>")?{name:o.replace(".<anonymous>",""),method:null,anonymous:!0}:{name:null,anonymous:!0};else if(o){let k=["global code","module code","eval code"].some(e=>o===e);k&&(l.host="Bun",l.type="runtime"),a=Stacklyn.parseFunctionName(o,{alias:r,rawName:o})}else o||(a={name:null,anonymous:!0});return Stacklyn._buildOutputObject({frameInfo:{raw:e,func:a,location:n},extra:{callSite:t??void 0,environment:l}})}static parseSpiderMonkey(e){if(!e||e.length<2)return;let t,n,a,l={host:"Firefox",format:"SpiderMonkey",type:"browser"},o=e.lastIndexOf("@"),[r,i]=-1!==o?[e.slice(0,o),e.slice(o+1)]:[null,""],{line:c,column:s}=Stacklyn._extractLocation(i),u=["[native code]","[wasm code]"].some(e=>i.includes(e)),m=["global code","module code","eval code"].some(e=>r.includes(e));if(i.includes(" line ")&&i.includes(" > "))n=function e(t){let n=null,a=t.split(" > ");for(let l=a.length-1;l>=0;l--){let o=a[l].match(/^(.*) line (\d+)$/)||a[l].match(/^(.*):(\d+):(\d+)$/);if(!o)continue;let r={sourceURL:o[1].includes("://")?o[1]:null,fileName:o[1].includes("://")?Stacklyn._getFilename(o[1]):null,line:Number(o[2]),column:o[3]?Number(o[3]):null,type:o[1].includes("://")?"file":o[1],eval:n};n=r}return n}(i);else if(i.startsWith("javascript:")){let f=Stacklyn._cleanPath(i.replace("javascript:",""),"partial");t={inlineSource:f,line:c,column:s,type:"JSUrl"}}else if(u||!i.match(/:(\d+)(?::(\d+))?$/))l={host:"Safari",format:"JavaScriptCore",type:"browser"},t={sourceURL:i,line:c,column:s,type:i.includes("[native code]")?"native":"wasm"};else{let p=Stacklyn._cleanPath(i);t={sourceURL:p,fileName:Stacklyn._getFilename(p),line:c,column:s}}if(r){if(r.includes("/")){let y=r.split("/"),d=[];y.forEach(e=>{let t;t=e.includes("<")?{name:e,index:e.match(/\[(\d+)\]</)||void 0,flags:["NESTED_ANON"]}:Stacklyn.parseFunctionName(e,{rawName:r}),d.push(t)});let h={...d[0]},k=h;for(let S=1;S<d.length;S++)k.func={...d[S]},k=k.func;a=h}else if(r.includes("*")){let[g,v]=r.split("*"),w=Stacklyn._parseFunctionname(v,{rawName:r});g.includes("setTimeout handler")?w.flags.push("TIMEOUT_HANDLER"):g.includes("promise callback")&&w.flags.push("PROMISE_CALLBACK"),w.flags.push("ASYNC"),a=w}else if(m){l={host:"Safari",format:"JavaScriptCore",type:"browser"};let E=r.split(" ")[0];a={name:null,anonymous:!0,flags:[E.toUpperCase()]}}else a=Stacklyn._parseFunctionname(r,{rawName:r})}else a={name:null,anonymous:!0};return"anonymous"===r&&"Function"===t?.eval.type&&(a.anonymous=!0),Stacklyn._buildOutputObject({frameInfo:{raw:e,func:a,location:n||t},extra:{environment:l}})}static parseIE(e){let t,n,a=e.match(/^ {3}at\s+(.*?)\s+\((.*?)\)$/);if(!a)return;let[,l,o]=a;if(t=["Global code","Anonymous function"].some(e=>l.includes(e))?{name:null,anonymous:!0,flags:[l.split(" ")[0].toUpperCase()]}:Stacklyn.parseFunctionName(l,{rawName:l}),"native code"===o)n={sourceURL:null,fileName:null,anonymous:!0,type:"native"};else if(["eval code","Function code","Unknown script code"].some(e=>o.includes(e))){let r=o.split(" code")[0].toLowerCase(),{line:i,column:c}=Stacklyn._extractLocation(o);n={sourceURL:null,fileName:null,line:i,column:c,anonymous:!0,type:r}}else n=Stacklyn._extractLocation(o);return Stacklyn._buildOutputObject({frameInfo:{raw:e,func:t,location:n},extra:{environment:{host:"Internet Explorer",format:"IE",type:"browser"}}})}static parseCarakan(e,t){let n="thrown",a,l,o,r={"Error thrown at ":"thrown","Error created at ":"constructed","Error initially occurred at ":"rethrown","called via ToPrimitive() from ":"toPrimitive","called via Function.prototype.apply() from ":"functionPrototypeApply","called via Function.prototype.call() from ":"functionPrototypeCall","called as bound function from ":"functionPrototypeBind","called from ":"functionCall"};Object.keys(r).some(t=>e.startsWith(t)&&(n=r[t],!0));let[,i,c]=e.match(/in (.+?) in (.+)/)||[null,null],[,s,u]=e.match(/line (\d+), column (\d+)/)||[null];i||([,o,c]=e.match(/[at|from] (.*?) in (.*)/)),i&&(i.includes("<anonymous function:")?l=i.replace("<anonymous function: ","").replace(">",""):i.includes("<anonymous function>")&&(l="!"),a="!"!==l?{...Stacklyn.parseFunctionName(l,{rawName:i}),anonymous:i.startsWith("<a")}:{name:null,anonymous:!0}),c.endsWith(":")&&(c=c.slice(0,-1));let m={context:t,sourceURL:c,fileName:c?.includes(" ")?void 0:Stacklyn._getFilename(c),line:+s,column:+u,anonymous:!c||"unknown location"===o||c.includes(" ")};return Stacklyn._buildOutputObject({frameInfo:{raw:e,func:a,location:m},extra:{type:n,environment:{host:"Opera",format:"carakan",type:"browser"}}})}static parseLinearB(e,t){let[,n,a,l,o,r]=e.match(/^Line (\d+) of ([a-z]+)(?:#(\d+))? script(?: in (.*?))?(?:: In function (.*))?$/),i={context:t,sourceURL:o,fileName:Stacklyn._getFilename(o),line:+n,anonymous:!o,script:{type:a||"unknown",index:+l}},c=r?Stacklyn.parseFunctionName(r,{rawName:r}):{name:null,anonymous:!r};return Stacklyn._buildOutputObject({frameInfo:{raw:e,func:c,location:i},extra:{environment:{host:"Opera",format:"linear-b",type:"browser"}}})}static parseEspruino(e){if(Stacklyn._isValidError(e))return Stacklyn._getEspruinoPairs(e.stack).map(e=>(function e(t,n,a){let l,o,r,i;if(t.includes("(")&&t.includes(")")){let c=t.match(/^ {4}at (.*?) \((.+)\)$/);c&&([,r,i]=c)}else{let s=t.match(/^ {4}at (.+)$/);s&&([,i]=s)}if(i){let{line:u,column:m}=Stacklyn._extractLocation(i),f=Stacklyn._cleanPath(i);l={sourceURL:f,fileName:Stacklyn._getFilename(f),line:u,column:m,anonymous:!f}}o=r?Stacklyn.parseFunctionName(r,{rawName:r}):{name:null,anonymous:!0};let p=l;return!p.fileName&&p.line&&p.column&&"REPL"===o.name&&o.flags.push("REPL"),Stacklyn._buildOutputObject({frameInfo:{raw:t,func:o,location:{context:n,caret:a,...l}},extra:{environment:{host:"Microcontroller Unit",format:"Espruino",type:"interpreter"}}})})(e.frame,e.context,e.caret))}static parseOpera(e){if(!Stacklyn._isValidError(e))return;let t=[],n=Stacklyn._detectOperaMode(e),a=Stacklyn._getOperaPairs(Stacklyn._getOperaStack(e));return a.forEach(e=>{if("carakan"===n)t.push(Stacklyn.parseCarakan(e.frame,e.context));else if("linear-b"===n)t.push(Stacklyn.parseLinearB(e.frame,e.context));else throw new Stacklyn.Error("Invalid Opera error provided for parsing")}),t}static parseFunctionName(e,{alias:t,rawName:n}){let a,l;/\[.*?\]/.test(e)&&(e=e.replace(/\[(.*?)\]/g,(e,t)=>"."+t));let o=e.match(/^(.+?)\((.*)\)$/);if(o)try{l=Function(`return [${o[2]}]`)()}catch{l=o[2].split(", ")}let r=o?o[1]:e;if(r.startsWith("./"))a={name:null,rawName:n,anonymous:!0};else if(r.includes(".")){let i=r.split("."),c=i.pop(),s=i.join(".");a={name:s,rawName:n,method:c,alias:t,flags:["DIRECT"],args:l,anonymous:!s}}else if(["get ","set ","new ","async "].some(e=>r.startsWith(e))){let[u,m]=r.split(" "),f;if(m.includes(".")){let p=m.split(".");f=p.pop(),m=p.join(".")}let y=(u.endsWith("et")?u+"ter":"new"===u?"constructor":u).toUpperCase();a={name:m,rawName:n,method:f,alias:t,prefix:u,flags:["PREFIX",y],args:l,anonymous:!m}}else a={name:r,rawName:n,alias:t,flags:[],args:l,anonymous:!r};return a.name===n&&(a.rawName=void 0),void 0!==l&&a.flags.push("ARGS"),"eval"===r&&a.flags.push("EVAL"),a}static convert(e,t){let n=[],a={Carakan:{host:"Opera",format:"carakan",type:"browser"},Chakra:{host:"Internet Explorer",format:"IE",type:"browser"},Espruino:{host:"MCU Unit",format:"Espruino",type:"interpreter"},LinearB:{host:"Opera",format:"linear-b",type:"browser"},SpiderMonkey:{host:"Firefox",format:"SpiderMonkey",type:"browser"},V8:{host:"Chromium",format:"V8",type:"browser"}},l=Object.entries({Carakan:["Carakan"],Chakra:["Edge (Legacy)","Internet Explorer","IE"],Espruino:["Espruino"],LinearB:["LinearB","linear-b","Linear B"],SpiderMonkey:["Firefox","Netscape","Tor","SpiderMonkey","Mocha"],V8:["Brave","Chrome","Chromium","Edge","Opera","Opera GX","Vivaldi","Node.js","V8"]}).find(([,e])=>e.includes(t))?.[0];if(!l||!a[l])throw new Stacklyn.Error(`invalid .convert() target: '${t}'`);return e.forEach(e=>{e.environment=a[l],n.push(Stacklyn.stringify(e))}),n.filter(Boolean).join("\n")}static stringify(e){if(Array.isArray(e))return e.map(e=>Stacklyn.stringify(e));let t="",n=e.func.args?`(${e.func.args.join(", ")})`:"",a=(e.func.name||e.func.rawName||"")+(e.func.method?"."+e.func.method:"");function l(e){return e.line?":"+e.line+(e.column?":"+e.column:""):""}let o=l(e.location);if("V8"===e.environment.format){let r=e.location.eval?c(e.location):e.location.sourceURL+o,i=e.func.alias?` [as ${e.func.alias}]`:"";function c(e){return`${function e(t){return t.eval?`eval at ${t.name} (${e(t.eval)})`:`eval at ${t.name} (${t.sourceURL}${l(t)})`}(e)}, ${e.sourceURL}${l(e)}`}t="    at "+(a?`${a}${n}${i} (${r})`:r)}else if("SpiderMonkey"===e.environment.format){if(e.location.eval&&e.location.sourceURL.includes("<anonymous>"))return"";function c(e){return function e(t){return t.eval?`${t.sourceURL??t.type??"eval"} line ${t.line} > ${e(t.eval)}`:`${t.sourceURL??t.type}${l(t)}`}(e)}let s=("eval"===e.func.name?"":a)+n,u;t+=s+"@"+(u="JSUrl"===e.location.type?"javascript:"+e.location.inlineSource+o:e.location.eval?c(e.location):(e.location.sourceURL||"debugger eval code")+o)}else if("carakan"===e.environment.format){let m=e.func.name?`<anonymous function: ${e.func.name}>`:"<anonymous function>",f=(e.func.anonymous?m:a)+n;t=({thrown:"Error thrown at",constructed:"Error created at",rethrown:"Error initially occurred at",toPrimitive:"called via ToPrimitive() from",functionPrototypeApply:"called via Function.prototype.apply() from",functionPrototypeCall:"called via Function.prototype.call() from",functionPrototypeBind:"called as bound function from",functionCall:"called from"})[e.type],e.location.anonymous&&!e.location.line&&(t+=" unknown location"),e.location.line&&(t+=` line ${e.location.line}, column ${e.location.column}`),t+=` in ${f} in ${e.location.sourceURL}:
    ${e.location.context}`}else if("linear-b"===e.environment.format){let p;"inline"===e.location.script.type&&(p="#"+e.location.script.index);let y=["unknown","function","eval"].some(t=>e.location.script.type===t);t=`  Line ${e.location.line} of ${e.location.script.type}${p} script`,y||e.location.anonymous||(t+=` in ${e.location.sourceURL}`),a&&(t+=`: In function ${a}${n}`),t+=`
    ${e.location.context||"/* no source available */"}`}else if("IE"===e.environment.format){let d=h[e.location.type],h={eval:"eval code",function:"Function code",unknown:"Unknown script code"};e.location.type||(d=e.location.sourceURL+o),t=`   at ${e.func.rawName} (${d})`}else if("Espruino"===e.environment.format){let k=`:${e.location.line}:${e.location.column}`,S=`${e.location.fileName||""}${k}`;t=`    at ${e.func.name?`${a} (${S})`:S}`,e.location.context&&(t+="\n    "+e.location.context,e.location.caret?t+="\n"+e.location.caret:t+=`
${" ".repeat(e.location.context.length+1)}^`)}return t}static serializeError(e){let t=e instanceof Error?Object.getPrototypeOf(e):Error.prototype,n=Object.create(t);return["name","message","stack","cause","errors","error","suppressed","toString","code","errno","syscall","address","port","path","dest","spawnargs","fileName","lineNumber","columnNumber","sourceURL","line","column","number","description","arguments","stacktrace","opera#sourceloc"].forEach(t=>{let a=e[t];(a||!1===a||null===a)&&(n[t]="function"==typeof a?a.call(e):a)}),n}static getCallSites(e){let t=Error.prepareStackTrace;try{Error.prepareStackTrace=(e,t)=>t;let n=e.stack;if(!Array.isArray(n))return null;let a=n.filter(function e(t){return t.getPosition?.()!==0}).map(e=>({scope:function e(t){let n=t.toString(),a=n.replace(/\[object (\w+)]/,"$1");return a.toLowerCase()}(e.getThis?.()),func:{name:e.getFunctionName?.(),typeName:e.getTypeName?.(),sourceCode:e.getFunction?.()?.toString?.()||"",reference:e.getFunction?.(),flags:{native:e.isNative?.(),constructor:e.isConstructor?.(),async:e.isAsync?.(),topLevel:e.isToplevel?.()},eval:{origin:e.getEvalOrigin?.(),isEval:e.isEval?.()},promise:{all:e.isPromiseAll?.(),index:e.getPromiseIndex?.()}},location:{sourceURL:e.getScriptNameOrSourceURL?.(),scriptHash:e.getScriptHash?.(),line:e.getLineNumber?.(),column:e.getColumnNumber?.(),position:e.getPosition?.(),enclosingLine:e.getEnclosingLineNumber?.(),enclosingColumn:e.getEnclosingColumnNumber?.()}})),l=`${e.toString()}
`+n.map(e=>"    at "+e.toString()).join("\n");return e.stack=l,{callSites:a,stack:l}}catch{return null}finally{Error.prepareStackTrace=t}}static async map(e){let t=[];for(let n of e){let a,{sourceURL:l=null,fileName:o=null,line:r=null,column:i=null}=n.location;try{a=await (await fetch(l+".map")).json()}catch(c){if("undefined"!=typeof require)a=JSON.parse(require("fs").readFileSync(require("path").resolve(__dirname,l+".map"),"utf8"));else throw new Stacklyn.Error("Could not fetch source map "+l+".map:",c.toString())}let s=new Stacklyn._SourceMapper(a).originalPositionFor({line:r,column:i});n.func.name=s.name||n.func.name,n.func.anonymous=!s.name,n.location.sourceURL=s.source||l,n.location.fileName=Stacklyn._getFilename(s.source)||o,n.location.line=s.line||r,n.location.column=s.column||i,n.location.anonymous=!s.source||!l,n.raw=Stacklyn.stringify(n),n={...n,sourcemapped:!0},t.push(n)}return t}static async enrich(e,t=5){return(await Promise.all(e.map(e=>Stacklyn._prependContext(e,t)))).filter(Boolean)}static _SourceMapper=class{constructor(e){this.sources=e.sources||[],this.names=e.names||[],this.mappings=this._parseMappings(e.mappings||"")}_parseMappings(e){function t(e,t){let n=0,a=0,l;var o={};for(let r=0;r<64;)o["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[r]]=r++;for(;null==(l=o[e[t++]])?(()=>{throw new Stacklyn.Error("bad VLQ character")})():(n|=(31&l)<<a,a+=5,32&l););return{value:(n>>1)*(1&n?-1:1),nextOffset:t}}let n=0,a=0,l=0,o=0,r=0;var i=[],c=e.split(";");for(let s=0;s<c.length;s++){let u=0;n=0;var m=c[s];if(m)for(;u<m.length;){var f=t(m,u),p=(n+=f.value,u=f.nextOffset,{generatedLine:s+1,generatedColumn:n});u<m.length&&","!==m[u]&&(a+=(f=t(m,u)).value,p.sourceIndex=a,l+=(f=t(m,u=f.nextOffset)).value,p.sourceLine=l,o+=(f=t(m,u=f.nextOffset)).value,p.sourceColumn=o,(u=f.nextOffset)<m.length)&&","!==m[u]&&(r+=(f=t(m,u)).value,p.nameIndex=r,u=f.nextOffset),i.push(p),u<m.length&&","===m[u]&&u++}}return i}originalPositionFor(e){let t=null,n=this.mappings.filter(t=>t.generatedLine===e.line);if(!n.length)return{source:null,line:null,column:null,name:null};for(let a of n)if(a.generatedColumn<=e.column)t=a;else break;return t&&null!==t.sourceIndex?{source:this.sources[t.sourceIndex]||null,line:t.sourceLine+1,column:t.sourceColumn,name:null!==t.nameIndex?this.names[t.nameIndex]:null}:{source:null,line:null,column:null,name:null}}};static Error=class extends Error{constructor(e,t={}){super(e,t),this.name="StacklynError",t.cause&&(this.cause=t.cause)}};static _getOperaStack(e){let t=e.message?.split(/\n(?:\s+)?Backtrace:(?:\s+)?(?:\n)?/)[1]||null,n=e.message?.split(/\n(?:\s+)?stacktrace:(?:\s+)?(?:\n)?/)[1]||null;if(e.stacktrace?.includes("opera:config#UserPrefs"))return t;if(!1===e.stacktrace)throw new Stacklyn.Error("The specified error came from somewherewith stack traces disabled, enable 'opera:config#UserPrefs|Exceptions Have Stacktrace' if this is your error.");return e.stacktrace||n||t}static _getOperaPairs(e){let t=e.split("\n"),n=[];for(let a=0;a<t.length;a++){let l=t[a],o=t[a-1];if(l?.startsWith("    ")){let r=o?.startsWith("  Line ")?o.slice(2):o,i=l.slice(4);n.push({frame:r,context:i})}}return n}static _detectOperaMode(e){let t="failed";try{let n=Stacklyn._getOperaStack(e);for(let a of n.split("\n")){let l=["called via ","called from ","Error thrown ","Error created ","Error initially "],o=l.some(e=>a.includes(e));t=o?"carakan":"linear-b";break}}catch{}return t}static _extractLocation(e){let t=e.match(/:(\d+)(?::(\d+))?$/);return{line:t?+t[1]:null,column:t?+t[2]:null}}static _getFilename(e){return decodeURIComponent(e.split("/").pop())}static _cleanPath(e,t="full"){return"full"===t?e.replace(/:\d+:\d+$/,"").replace(/\\/g,"/"):"partial"===t?e.replace(/:\d+:\d+$/,""):void 0}static _buildOutputObject({frameInfo:e,extra:t={}}){let n={raw:e.raw,func:e.func,location:e.location,...t||void 0};return n}static async _prependContext(e,t){if(!e.location||!e.location.fileName||e.location.anonymous)return;let n=await fetch(e.location.sourceURL).then(e=>e.text()),a=n.split(/\r?\n/),l=/^\s*\/\/#\s*sourceMappingURL=.+/m.test(n)||e.location.fileName.includes(".min.")||n.length/a.length>100;if(!l&&!(a.length<2*t+1))return{contextabove:a.slice(Math.max(0,e.location.line-1-t),e.location.line-1),context:a[e.location.line-1]??"",contextbelow:a.slice(e.location.line,e.location.line+t),...e}}static _getEspruinoPairs(e){let t=[],n=[],a=[];return e.split("\n").forEach(e=>{e.startsWith("    at ")?t.push(e):n.push(e),e.includes("  ^")&&a.push(e)}),t.map((e,t)=>({frame:e,context:n[t]?.startsWith("    ")?n[t].slice(4):n[t],caret:a[t]}))}static _isValidError(e){return e&&"object"==typeof e&&["stack","message","stacktrace"].some(t=>t in e)}static _filterUndefined(e){return e.map(e=>JSON.parse(JSON.stringify(e,(e,t)=>void 0===t?void 0:t)))}}"function"==typeof define&&define.amd&&define("stacklyn",[],()=>Stacklyn),"undefined"!=typeof global&&(global.Stacklyn=Stacklyn),"undefined"!=typeof module&&(module.exports=Stacklyn),"undefined"!=typeof exports&&(exports.Stacklyn=Stacklyn),"undefined"!=typeof window&&(window.Stacklyn=Stacklyn),"undefined"!=typeof self&&(self.Stacklyn=Stacklyn),"undefined"!=typeof globalThis&&(globalThis.Stacklyn=Stacklyn);